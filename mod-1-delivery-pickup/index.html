<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Foodie - Pedido</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              brand: {
                50: '#f2f7f1',
                700: '#13532a',
                800: '#0f4a22'
              }
            },
            fontFamily: {
              sans: ['Inter', 'ui-sans-serif', 'system-ui']
            }
          }
        }
      }
    </script>
    <style>
      /* Pequeñas mejoras encima de Tailwind */
      .input-shadow { box-shadow: 0 1px 0 rgba(0,0,0,0.03); }
      .toggle-inactive { background-color: #f3f4f6; }
    </style>
  </head>
  <body class="bg-brand-50 min-h-screen text-gray-800 font-sans">
    <header class="max-w-6xl mx-auto px-6 py-6 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-4 h-4 bg-black rotate-45"></div>
        <span class="font-semibold">Foodie</span>
      </div>
      <nav class="hidden md:flex items-center gap-6 text-sm text-gray-700">
        <a href="#">Menú</a>
        <a href="#">Ofertas</a>
        <a href="#">Recompensas</a>
        <button class="flex items-center gap-2 bg-white px-3 py-1 rounded-full shadow-sm">Carrito <span class="text-xs bg-gray-200 rounded-full px-2">0</span></button>
        <img src="https://images.unsplash.com/photo-1545996124-1b0a7b8be1d1?q=80&w=40&auto=format&fit=crop&crop=faces" alt="avatar" class="w-9 h-9 rounded-full border"/>
      </nav>
    </header>

    <main class="max-w-4xl mx-auto px-6 py-10">
      <section class="text-center mb-8">
        <h1 class="text-3xl md:text-4xl font-extrabold">¿Cómo quieres recibir tu pedido?</h1>
        <div class="mt-6 flex justify-center gap-4">
          <button id="deliveryBtn" aria-pressed="true" class="px-8 py-3 rounded-full bg-brand-800 text-white font-semibold shadow">Entrega</button>
          <button id="pickupBtn" aria-pressed="false" class="px-8 py-3 rounded-full toggle-inactive text-gray-700 font-semibold">Recogida</button>
        </div>
      </section>

      <section class="bg-transparent">
        <form id="checkoutForm" class="max-w-2xl mx-auto space-y-6" novalidate>
          <div>
            <label class="block text-sm font-medium mb-2">Nombre completo</label>
            <input id="fullName" name="fullName" required placeholder="Ingresa tu nombre completo" class="w-full rounded-md border border-gray-300 p-3 bg-white placeholder-gray-400 input-shadow" />
            <p id="err-name" class="mt-1 text-xs text-red-600 hidden">Por favor ingresa tu nombre.</p>
          </div>

          <div>
            <label class="block text-sm font-medium mb-2">Teléfono</label>
            <input id="phone" name="phone" required placeholder="Ingresa tu teléfono" class="w-full rounded-md border border-gray-300 p-3 bg-white placeholder-gray-400 input-shadow" />
            <p id="err-phone" class="mt-1 text-xs text-red-600 hidden">Por favor ingresa tu teléfono.</p>
          </div>

          <div>
            <label class="block text-sm font-medium mb-2">Correo electrónico</label>
            <input id="email" name="email" type="email" required placeholder="Ingresa tu correo electrónico" class="w-full rounded-md border border-gray-300 p-3 bg-white placeholder-gray-400 input-shadow" />
            <p id="err-email" class="mt-1 text-xs text-red-600 hidden">Introduce un correo válido.</p>
          </div>

          <div id="addressBlock">
            <label class="block text-sm font-medium mb-2">Dirección de entrega</label>
            <input id="address" name="address" placeholder="Ingresa tu dirección de entrega" class="w-full rounded-md border border-gray-300 p-3 bg-white placeholder-gray-400 input-shadow" />
            <p id="err-address" class="mt-1 text-xs text-red-600 hidden">Por favor ingresa la dirección.</p>
          </div>

          <div class="flex items-center justify-between mt-2 text-sm font-semibold">
            <div>Costo de envío y ETA</div>
            <div id="coverage" class="text-xs text-gray-500">Dirección fuera del área de cobertura</div>
          </div>

          <div class="pt-6">
            <button id="proceedBtn" type="submit" class="w-full bg-brand-800 text-white py-3 rounded-lg font-semibold shadow-lg">Continuar al menú</button>
          </div>
        </form>
      </section>
    </main>

    <script>
      // Toggle Delivery / Pickup
      const deliveryBtn = document.getElementById('deliveryBtn');
      const pickupBtn = document.getElementById('pickupBtn');
      const addressBlock = document.getElementById('addressBlock');
      const coverage = document.getElementById('coverage');

      function setMode(mode) {
        if (mode === 'delivery') {
          deliveryBtn.classList.remove('toggle-inactive','text-gray-700');
          deliveryBtn.classList.add('bg-brand-800','text-white');
          deliveryBtn.setAttribute('aria-pressed','true');

          pickupBtn.classList.remove('bg-brand-800','text-white');
          pickupBtn.classList.add('toggle-inactive','text-gray-700');
          pickupBtn.setAttribute('aria-pressed','false');

          addressBlock.classList.remove('hidden');
          coverage.textContent = 'Dirección fuera del área de cobertura';
        } else {
          pickupBtn.classList.remove('toggle-inactive','text-gray-700');
          pickupBtn.classList.add('bg-gray-100','text-gray-700');
          pickupBtn.setAttribute('aria-pressed','true');

          deliveryBtn.classList.remove('bg-brand-800','text-white');
          deliveryBtn.classList.add('toggle-inactive','text-gray-700');
          deliveryBtn.setAttribute('aria-pressed','false');

          // Para recogida, ocultar dirección y actualizar mensaje
          addressBlock.classList.add('hidden');
          coverage.textContent = 'Recogida — no requiere envío';
        }
      }

      deliveryBtn.addEventListener('click', () => setMode('delivery'));
      pickupBtn.addEventListener('click', () => setMode('pickup'));

      // Initialize default
      setMode('delivery');

      // Basic validation
      const form = document.getElementById('checkoutForm');
      const errName = document.getElementById('err-name');
      const errPhone = document.getElementById('err-phone');
      const errEmail = document.getElementById('err-email');
      const errAddress = document.getElementById('err-address');

      function validateEmail(email) {
        return /\S+@\S+\.\S+/.test(email);
      }

      form.addEventListener('submit', function(e) {
        e.preventDefault();
        let valid = true;

        const nameVal = document.getElementById('fullName').value.trim();
        const phoneVal = document.getElementById('phone').value.trim();
        const emailVal = document.getElementById('email').value.trim();
        const addressVal = document.getElementById('address') ? document.getElementById('address').value.trim() : '';

        // Reset errors
        [errName, errPhone, errEmail, errAddress].forEach(el => el.classList.add('hidden'));

        if (!nameVal) { errName.classList.remove('hidden'); valid = false; }
        if (!phoneVal) { errPhone.classList.remove('hidden'); valid = false; }
        if (!emailVal || !validateEmail(emailVal)) { errEmail.classList.remove('hidden'); valid = false; }
        // Address required only for delivery
        if (deliveryBtn.getAttribute('aria-pressed') === 'true') {
          if (!addressVal) { errAddress.classList.remove('hidden'); valid = false; }
        }

        if (valid) {
          // Navegar a la siguiente vista (lista de pedidos)
          const mode = (deliveryBtn.getAttribute('aria-pressed') === 'true') ? 'delivery' : 'pickup';
          const nextUrl = new URL('./pedidos/index.html', window.location.href);
          nextUrl.searchParams.set('mode', mode);
          window.location.href = nextUrl.toString();
        } else {
          // Scroll to first error
          const firstErr = document.querySelector('p.text-red-600:not(.hidden)');
          if (firstErr) firstErr.scrollIntoView({behavior: 'smooth', block: 'center'});
        }
      });
    </script>
  </body>
</html>
